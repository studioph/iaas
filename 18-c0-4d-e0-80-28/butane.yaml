variant: fcos
version: 1.6.0
systemd:
  units:
    - name: podman.service
      enabled: true
    - name: serial-getty@ttyS0.service
      enabled: true
    - name: rpm-ostree-countme.service
      enabled: false
    - name: rpm-ostree-countme.timer
      enabled: false
    - name: install-packages.service
      enabled: true
      contents: |
        [Unit]
        Description=Layer packages with rpm-ostree
        Wants=network-online.target
        After=network-online.target
        # We run before `zincati.service` to avoid conflicting rpm-ostree
        # transactions.
        Before=zincati.service
        ConditionPathExists=!/var/lib/%N.stamp

        [Service]
        Type=oneshot
        RemainAfterExit=yes
        # `--allow-inactive` ensures that rpm-ostree does not return an error
        # if the package is already installed. This is useful if the package is
        # added to the root image in a future Fedora CoreOS release as it will
        # prevent the service from failing.
        ExecStart=/usr/bin/rpm-ostree install -y --allow-inactive podman-docker podman-compose htop pciutils usbutils net-tools bind-utils
        ExecStart=/bin/touch /var/lib/%N.stamp
        ExecStart=/bin/systemctl --no-block reboot

        [Install]
        WantedBy=multi-user.target
storage:
  files:
    - path: /etc/selinux/config
      mode: 0600
      overwrite: true
      contents:
        inline: |
          # This file controls the state of SELinux on the system.
          # SELINUX= can take one of these three values:
          #       enforcing - SELinux security policy is enforced.
          #       permissive - SELinux prints warnings instead of enforcing.
          #       disabled - No SELinux policy is loaded.
          SELINUX=permissive
          # SELINUXTYPE= can take one of these two values:
          #       targeted - Targeted processes are protected,
          #       mls - Multi Level Security protection.
          SELINUXTYPE=targeted
    - path: /etc/NetworkManager/system-connections/1g.nmconnection
      mode: 0600
      contents:
        inline: |
          [connection]
          id=1g
          type=ethernet
          autoconnect=true
          dns-over-tls=0

          [ethernet]
          mac-address=18:c0:4d:e0:80:28

          [ipv4]
          dns=10.0.1.1
          address1=10.0.1.3/24
          gateway=10.0.1.1
          method=manual
    - path: /etc/NetworkManager/system-connections/10g.nmconnection
      mode: 0600
      contents:
        inline: |
          [connection]
          id=10g
          type=ethernet
          autoconnect=true

          [ethernet]
          mac-address=e4:1d:2d:7e:f4:c0

          [ipv4]
          address1=10.0.10.3/24
          method=manual
          dhcp-timeout=1
    - path: /etc/sysctl.d/20-silence-audit.conf
      contents:
        inline: kernel.printk=4
    - path: /etc/hostname
      contents:
        inline: coreos
    - path: /etc/zincati/config.d/51-rollout-wariness.toml
      contents:
        inline: |
          [identity]
          rollout_wariness = 0.5
    - path: /etc/zincati/config.d/55-updates-strategy.toml
      contents:
        inline: |
          [updates]
          strategy = "periodic"
          [[updates.periodic.window]]
          days = ["Sun"]
          start_time = "5:00"
          length_minutes = 60
passwd:
  users:
    - name: core
      ssh_authorized_keys:
        - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCn5exRlpq7WUhbhBwkNbsUBO/7HdpcP3HadkL9/V3ug7fY90QoIIk935JDH5mBfgLblIEUDzSFSUvUVnKe+epETQysPiVSF06+9iz63/uKlr7mrvlmC3Pmh726MLNLpDVqrJ2g4tjmC2iJpyc5sAKoQsJPv/7Pi2DlVOVAs1H7ci3uclnyT2ou13Sj5rImLqcgT22DFqDraEDWlwuMIYr1epxpjbUmx9hjB/SNWXFm/O75naV8LfderZ2WyI1j75rqkDBEXcHYd/SCPM58u9FlHeXJNkxr9rWRGpinqLEuj0hSFdvilKFZtawHSZ4ha4UGWFbywaxoDTsErLg8VGyG7w8m541YjbCKE+/7znbfsv8AqrYj3Hx5oV8SQwKTu75XxvHzmY37QVvPInZiSk1QeKpTUEqVc9duH9zDyNvje/qMtpsSYee/gTGFt+p2SX2kNW4t7PRLG93E9Kcbn/0IjFZ6snXbrOGcuV8ohervtD2Cmzubgi0wlfiltgDQnvs= paul@studiop-dev
      groups:
        - docker